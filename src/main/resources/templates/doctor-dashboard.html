<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctor Dashboard | ClinicPro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #11998e;
            --danger: #eb3349;
            --warning: #f093fb;
            --light: #f8f9ff;
            --dark: #2d3748;
            --gradient: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            --success-gradient: linear-gradient(135deg, var(--success) 0%, #38ef7d 100%);
            --danger-gradient: linear-gradient(135deg, var(--danger) 0%, #f45c43 100%);
            --shadow: 0 10px 30px rgba(0,0,0,0.1);
            --hover-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        body { font-family: 'Poppins', sans-serif; background: var(--light); min-height: 100vh; color: var(--dark); }
        .navbar { background: var(--gradient) !important; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .hero-section { background: var(--gradient); color: white; padding: 60px 0; margin-bottom: 50px; border-radius: 0 0 30px 30px; position: relative; overflow: hidden; }
        .hero-section::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%); animation: pulse 4s ease-in-out infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(0.8); opacity: 0.5; } 50% { transform: scale(1.2); opacity: 0.2; } }
        .stat-card { background: white; border-radius: 20px; padding: 30px; box-shadow: var(--shadow); border: none; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); height: 100%; position: relative; overflow: hidden; }
        .stat-card:hover { transform: translateY(-8px) scale(1.02); box-shadow: var(--hover-shadow); }
        .stat-card::after { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--gradient); }
        .stat-icon { width: 70px; height: 70px; border-radius: 18px; display: flex; align-items: center; justify-content: center; font-size: 28px; margin-bottom: 20px; background: rgba(102, 126, 234, 0.1); color: var(--primary); }
        .stat-number { font-size: 36px; font-weight: 700; margin: 0; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .action-card { background: white; border-radius: 25px; padding: 40px 30px; box-shadow: var(--shadow); border: none; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); cursor: pointer; height: 100%; text-decoration: none; color: var(--dark); display: block; text-align: center; }
        .action-card:hover { transform: translateY(-10px) scale(1.03); box-shadow: var(--hover-shadow); color: var(--primary); }
        .action-card i { font-size: 60px; margin-bottom: 25px; transition: all 0.3s ease; }
        .action-card:hover i { transform: scale(1.2) rotate(5deg); background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .appointments-widget { background: white; border-radius: 25px; box-shadow: var(--shadow); overflow: hidden; }
        .widget-header { background: var(--gradient); color: white; padding: 25px 30px; }
        .appointment-row { padding: 20px 30px; border-bottom: 1px solid #f0f0f0; transition: all 0.3s ease; }
        .appointment-row:hover { background: #f8f9ff; transform: translateX(5px); }
        .status-badge { padding: 8px 16px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .status-PENDING { background: #fff3cd; color: #856404; }
        .status-CONFIRMED { background: #d1ecf1; color: #0c5460; }
        .status-COMPLETED { background: #d4edda; color: #155724; }
        .status-CANCELLED { background: #f8d7da; color: #721c24; }
        .error-box { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand fw-bold" href="/doctor/dashboard">
            <i class="fas fa-hospital-alt me-2"></i>ClinicPro
        </a>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav mx-auto">
                <li class="nav-item">
                    <a class="nav-link active" href="/doctor/dashboard">
                        <i class="fas fa-home me-1"></i>Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/doctor/appointments">
                        <i class="fas fa-calendar me-1"></i>Appointments
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/doctor/profile">
                        <i class="fas fa-user me-1"></i>Profile
                    </a>
                </li>
            </ul>
            <div class="d-flex align-items-center">
                <span class="navbar-text text-white me-3">
                    <i class="fas fa-user-md me-1"></i>
                    <span th:text="${user?.userName}">Dr. Name</span>
                </span>
                <a href="/logout" class="btn btn-outline-light btn-sm">
                    <i class="fas fa-sign-out-alt me-1"></i>Logout
                </a>
            </div>
        </div>
    </div>
</nav>

<div class="hero-section">
    <div class="container position-relative">
        <!-- MESAZH GABIMI -->
        <div th:if="${errorMessage}" class="error-box">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <strong>Gabim:</strong> <span th:text="${errorMessage}"></span>
        </div>

        <h1 class="display-4 fw-bold" th:if="${user?.userName}">
            Welcome back, Dr. <span th:text="${user.userName}">Smith</span>!
        </h1>
        <h1 class="display-4 fw-bold" th:unless="${user?.userName}">
            Welcome back, Doctor!
        </h1>
        <p class="mb-0 opacity-75 fs-5">Your clinic overview at a glance</p>
    </div>
</div>

<div class="container mb-5">
    <div class="row g-4 mb-5">
        <div class="col-md-3">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <h3 class="stat-number" th:text="${appointments != null ? #lists.size(appointments) : 0}">0</h3>
                <p class="text-muted mb-0">Total Appointments</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(17, 153, 142, 0.1); color: var(--success);">
                    <i class="fas fa-clock"></i>
                </div>
                <h3 class="stat-number" th:text="${appointments != null ? #lists.size(appointments.?[status != null and status.name() == 'PENDING']) : 0}">0</h3>
                <p class="text-muted mb-0">Awaiting Confirmation</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(235, 51, 73, 0.1); color: var(--danger);">
                    <i class="fas fa-calendar-day"></i>
                </div>
                <h3 class="stat-number" th:text="${appointments != null ? #lists.size(appointments.?[date != null and #dates.format(date, 'yyyy-MM-dd') == #dates.format(#dates.createNow(), 'yyyy-MM-dd')]) : 0}">0</h3>
                <p class="text-muted mb-0">Scheduled Today</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(240, 147, 251, 0.1); color: var(--warning);">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h3 class="stat-number" th:text="${appointments != null ? #lists.size(appointments.?[status != null and status.name() == 'COMPLETED']) : 0}">0</h3>
                <p class="text-muted mb-0">Completed This Month</p>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-5">
        <div class="col-md-4">
            <a href="/doctor/appointments" class="action-card">
                <i class="fas fa-list-alt" style="color: var(--primary);"></i>
                <h5 class="fw-600 mb-2">Manage Appointments</h5>
                <p class="text-muted mb-0">View and edit all appointments</p>
            </a>
        </div>
        <div class="col-md-4">
            <a href="/doctor/appointments/new" class="action-card">
                <i class="fas fa-plus-circle" style="color: var(--success);"></i>
                <h5 class="fw-600 mb-2">Create Appointment</h5>
                <p class="text-muted mb-0">Add new appointment slot</p>
            </a>
        </div>
        <div class="col-md-4">
            <a href="/doctor/profile" class="action-card">
                <i class="fas fa-user-cog" style="color: var(--warning);"></i>
                <h5 class="fw-600 mb-2">Profile Settings</h5>
                <p class="text-muted mb-0">Update your information</p>
            </a>
        </div>
    </div>

    <div class="appointments-widget">
        <div class="widget-header">
            <h4 class="mb-0">
                <i class="fas fa-calendar-week me-2"></i>Recent Appointments
            </h4>
        </div>

        <div th:if="${appointments == null or #lists.isEmpty(appointments)}" class="text-center py-5">
            <i class="fas fa-calendar-times fa-4x text-muted mb-3"></i>
            <p class="text-muted fs-5 mb-3">No appointments scheduled yet</p>
            <a href="/doctor/appointments/new" class="btn btn-primary btn-lg">
                <i class="fas fa-plus me-2"></i>Schedule First Appointment
            </a>
        </div>

        <div th:each="appt, iterStat : ${appointments}" th:if="${iterStat.index < 6 and appt != null}" class="appointment-row">
            <div class="row align-items-center">
                <div class="col-md-4">
                    <div class="d-flex align-items-center">
                        <div th:if="${appt.patient != null}" class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center me-3" style="width: 45px; height: 45px; font-weight: 600;">
                            <span th:text="${#strings.toUpperCase(#strings.substring(appt.patient.userName ?: 'U', 0, 1))}">U</span>
                        </div>
                        <div th:if="${appt.patient == null}" class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center me-3" style="width: 45px; height: 45px; font-weight: 600;">
                            <span>?</span>
                        </div>
                        <div>
                            <h6 class="mb-0 fw-500" th:text="${appt.patient?.userName}">Unknown Patient</h6>
                            <small class="text-muted" th:text="${appt.patient?.email}">no-email@example.com</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <i class="fas fa-calendar text-primary me-1"></i>
                    <span th:text="${appt.date != null ? #dates.format(appt.date, 'MMM dd, yyyy') : 'N/A'}">N/A</span>
                </div>
                <div class="col-md-2">
                    <i class="fas fa-clock text-primary me-1"></i>
                    <span th:text="${appt.time ?: 'N/A'}">N/A</span>
                </div>
                <div class="col-md-3 text-end">
                    <span th:if="${appt.status != null}"
                          class="status-badge"
                          th:classappend="'status-' + ${appt.status.name()}"
                          th:text="${appt.status.name()}">UNKNOWN</span>
                    <span th:if="${appt.status == null}" class="status-badge bg-secondary text-white">UNKNOWN</span>
                </div>
            </div>
        </div>

        <div class="text-center p-3" th:if="${appointments != null and #lists.size(appointments) > 6}">
            <a href="/doctor/appointments" class="btn btn-primary">
                View All Appointments <i class="fas fa-arrow-right ms-1"></i>
            </a>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>